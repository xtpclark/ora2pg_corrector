= Ora2Pg AI Corrector
:toc:
:source-highlighter: highlight.js

A smart web interface to accelerate Oracle to PostgreSQL migrations by automating the correction and validation of translated SQL code.

== Overview

Migrating from Oracle to PostgreSQL often involves using tools like `ora2pg` to perform the initial code translation. While `ora2pg` provides an excellent starting point, the generated SQL frequently requires manual corrections and extensive testing to ensure compatibility and correctness in a live PostgreSQL environment.

The Ora2Pg AI Corrector is designed to streamline this crucial "last mile" of the migration process. It provides a web-based, multi-client workspace where developers can use a powerful AI engine to automatically correct translated SQL and then validate it against a live PostgreSQL database using a unique "self-healing" engine.

== Key Features

* **Web-based, Multi-Client Workspace:** Manage multiple migration projects or clients, each with its own set of configurations for AI providers, database connections, and `ora2pg` settings.
* **AI-Powered SQL Correction:** A dual-editor view allows you to paste Oracle SQL and get an AI-generated PostgreSQL equivalent that corrects for common syntax and function differences (e.g., `NVL` to `COALESCE`, `VARCHAR2` to `VARCHAR`).
* **Intelligent Validation Engine:** This is the core of the application, designed to test the corrected SQL against a real database and automatically resolve schema dependencies.
** Proactive Schema Generation:** For `SELECT` queries, the engine first parses the SQL to identify all required tables. It then makes a single, consolidated call to the AI to generate the DDL for all missing tables at once, drastically speeding up the setup process.
** Reactive Self-Healing:** If an error occurs, the engine attempts to fix it automatically:
*** On-the-fly DDL:** Catches `relation "..." does not exist` errors (e.g., from `FOREIGN KEY` references) and asks the AI to generate the DDL for the specific missing object before retrying.
*** AI Query Correction:** Catches other errors (e.g., syntax errors, missing columns) and asks the AI to fix the query itself before retrying.
* **Fine-Grained User Control:** Two checkboxes, `Clean Slate` and `Auto-create Tables`, give the user complete control over the validation environment, enabling workflows for initial discovery, iterative development, and validation against pre-existing "golden" schemas.

== How It Works: The Typical Workflow

. **Load Oracle SQL:** A user selects their client/project and pastes the Oracle SQL generated by `ora2pg` (or written by hand) into the left-side editor.
. **Correct with AI:** The user clicks "Correct with AI". The application sends the Oracle code to the configured AI model and displays the translated PostgreSQL code in the right-side editor.
. **Review & Refine:** The user can review the AI's translation and make manual edits if necessary.
. **Validate:** The user configures the `Clean Slate` and `Auto-create Tables` options and clicks "Validate". The application attempts to execute the PostgreSQL code against the validation database, using the self-healing engine to resolve any schema or syntax issues.
. **Save:** Once validated, the user can save the final, corrected, and verified PostgreSQL code.

== Getting Started

=== Prerequisites

* Docker
* Docker Compose

=== Installation & Running

. Clone the repository:
+
[source,bash]
----
git clone <your-repository-url>
cd ora2pg-ai-corrector
----
. Create a `.env` file by copying the example. This file will store your application secrets and database configurations.
+
[source,bash]
----
cp .env.example .env
----
. Edit the `.env` file with your specific settings:
+
[source,text]
----
# For the application's internal database (SQLite or Postgres)
# DB_BACKEND=sqlite
# PG_DSN_CONFIG=postgresql://user:pass@host:port/app_db

# For the PostgreSQL database used for validation
VALIDATION_PG_DSN=postgresql://user:pass@host:port/validation_db

# Application secrets
APP_SECRET_KEY=your_super_secret_key
APP_ENCRYPTION_KEY=your_32_byte_fernet_encryption_key
----
. Build and run the application using Docker Compose:
+
[source,bash]
----
docker-compose up --build
----
. Access the web interface at `http://localhost:8000`.

== Configuration

* **AI Providers (`ai_config/ai_providers.json`):** Add or modify AI provider details in this file. The application will load these into its database on startup.
* **Ora2Pg Options (`ora2pg_config/default.cfg`):** The contents of this file are used to populate the available Ora2Pg configuration options in the UI's settings page.

== Future Enhancements

A key goal is to more deeply integrate the `ora2pg` tool itself into the workflow.

* **Direct Ora2Pg Integration:** Add a feature to run the `ora2pg` command directly from the web UI using the client's saved settings, automatically loading the output into the editor.
* **DDL Caching:** Implement a caching layer for AI-generated DDL to further reduce API calls and latency for common tables, with a manual "clear cache" option for users.
* **Batch Processing:** Allow the application to process an entire directory of `.sql` files, performing the correction and validation steps for each file and generating a summary report.# ora2pg_corrector
